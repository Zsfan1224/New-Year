<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>烟花动画</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background-color: black;
    }
    #cas {
      position: absolute;
      top: 0;
      left: 0;
    }
    #moon {
      display: none;
    }
  </style>
</head>
<body>

  <!-- 用于显示月亮的图片 -->
  <img id="moon" src="moon.png" alt="moon" width="80" height="80">

  <canvas id="cas"></canvas>

  <script>
    var canvas = document.getElementById("cas");
    var ocas = document.createElement("canvas");
    var octx = ocas.getContext("2d");
    var ctx = canvas.getContext("2d");
    ocas.width = canvas.width = window.innerWidth;
    ocas.height = canvas.height = window.innerHeight;

    var bigbooms = [];
    var stars = [];
    var maxRadius = 1;
    var lastTime;

    // 用于随机生成数值的函数
    function getRandom(a, b) {
      return Math.random() * (b - a) + a;
    }

    // 启动画布
    function initAnimate() {
      drawBg();
      lastTime = new Date();
      animate();
    }

    // 动画循环
    function animate() {
      ctx.save();
      ctx.fillStyle = "rgba(0,5,24,0.1)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.restore();

      var newTime = new Date();
      if (newTime - lastTime > 500 + (window.innerHeight - 767) / 2) {
        var random = Math.random() * 100 > 33 ? true : false;
        var x = getRandom(canvas.width / 5, canvas.width * 4 / 5);
        var y = getRandom(50, 200);
        if (random) {
          var bigboom = new Boom(getRandom(canvas.width / 3, canvas.width * 2 / 3), 2, "#FFF", {
            x: x,
            y: y
          });
          bigbooms.push(bigboom);
        } else {
          var bigboom = new Boom(getRandom(canvas.width / 3, canvas.width * 2 / 3), 2, "#FFF", {
            x: canvas.width / 2,
            y: 200
          });
          bigbooms.push(bigboom);
        }
        lastTime = newTime;
      }

      stars.forEach(function(star) {
        star.paint();
      });

      // 清理已死亡的烟花和碎片
      bigbooms = bigbooms.filter(function(bigboom) {
        if (!bigboom.dead) {
          bigboom._move();
          bigboom._drawLight();
          return true; // 保留活着的烟花
        }
        return false; // 移除死亡的烟花
      });

      // 更新并绘制所有烟花碎片
      bigbooms.forEach(function(bigboom) {
        bigboom.booms = bigboom.booms.filter(function(frag) {
          if (!frag.dead) {
            frag.moveTo();
            return true; // 保留活着的碎片
          }
          return false; // 移除死亡的碎片
        });
      });

      requestAnimationFrame(animate);
    }

    // 绘制背景中的星星
    function drawBg() {
      for (var i = 0; i < 100; i++) {
        var r = Math.random() * maxRadius;
        var x = Math.random() * canvas.width;
        var y = Math.random() * 2 * canvas.height - canvas.height;
        var star = new Star(x, y, r);
        stars.push(star);
        star.paint();
      }
    }

    // Boom 构造函数
    var Boom = function(x, r, c, boomArea) {
      this.booms = [];
      this.x = x;
      this.y = canvas.height + r;
      this.r = r;
      this.c = c;
      this.boomArea = boomArea;
      this.dead = false;
      this.ba = parseInt(getRandom(80, 200));
    };

    Boom.prototype = {
      _paint: function() {
        ctx.save();
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.r, 0, 2 * Math.PI);
        ctx.fillStyle = this.c;
        ctx.fill();
        ctx.restore();
      },
      _move: function() {
        var dx = this.boomArea.x - this.x,
            dy = this.boomArea.y - this.y;
        this.x += dx * 0.01;
        this.y += dy * 0.01;
        if (Math.abs(dx) <= this.ba && Math.abs(dy) <= this.ba) {
          this._boom();
          this.dead = true;
        } else {
          this._paint();
        }
      },
      _drawLight: function() {
        ctx.save();
        ctx.fillStyle = "rgba(255,228,150,0.3)";
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.r + 3 * Math.random() + 1, 0, 2 * Math.PI);
        ctx.fill();
        ctx.restore();
      },
      _boom: function() {
        var fragNum = getRandom(30, 200);
        var fanwei = parseInt(getRandom(300, 400));
        for (var i = 0; i < fragNum; i++) {
          var a = getRandom(-Math.PI, Math.PI);
          var x = getRandom(0, fanwei) * Math.cos(a) + this.x;
          var y = getRandom(0, fanwei) * Math.sin(a) + this.y;
          var radius = getRandom(0, 2);
          var frag = new Frag(this.x, this.y, radius, {a: 255, b: 255, c: 255}, x, y);
          this.booms.push(frag);
        }
      }
    };

    // 星星构造函数
    var Star = function(x, y, r) {
      this.x = x;
      this.y = y;
      this.r = r;
    };

    Star.prototype = {
      paint: function() {
        ctx.save();
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.r, 0, 2 * Math.PI);
        ctx.fillStyle = "rgba(255,255,255," + this.r + ")";
        ctx.fill();
        ctx.restore();
      }
    };

    // 烟花碎片构造函数
    var Frag = function(centerX, centerY, radius, color, tx, ty) {
      this.tx = tx;
      this.ty = ty;
      this.x = centerX;
      this.y = centerY;
      this.dead = false;
      this.centerX = centerX;
      this.centerY = centerY;
      this.radius = radius;
      this.color = color;
    };

    Frag.prototype = {
      paint: function() {
        ctx.save();
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI);
        ctx.fillStyle = "rgba(" + this.color.a + "," + this.color.b + "," + this.color.c + ",1)";
        ctx.fill();
        ctx.restore();
      },
      moveTo: function() {
        var dx = this.tx - this.x,
            dy = this.ty - this.y;
        this.x += dx * 0.1;
        this.y += dy * 0.1;
        if (Math.abs(dx) < 0.1 && Math.abs(dy) < 0.1) {
          this.dead = true;
        }
        this.paint();
      }
    };

    // 每秒钟生成 5 个烟花
    setInterval(function() {
      for (let i = 0; i < 5; i++) {
        var x = getRandom(canvas.width / 5, canvas.width * 4 / 5);
        var y = getRandom(50, 200);
        var bigboom = new Boom(getRandom(canvas.width / 3, canvas.width * 2 / 3), 2, "#FFF", {x: x, y: y});
        bigbooms.push(bigboom);
      }
    }, 200);  // 每 200 毫秒生成一个烟花

    // 初始化动画
    initAnimate();
  </script>

</body>
</html>
